<div class="search-wrapper">
    <%= form_tag items_path, :method => :get do %>
        <p>
            <%= text_field_tag :search, params[:search], :placeholder => "SEARCH FOR THINGS TO BORROW." %>
            <%= submit_tag "", :id => "submit", :name => nil %>
        </p>
    <% end %>
</div>

<section class="landing-page">
    <section class="landing-page--items">
        <dl class="accordion">
            <% if @borrows_pending.count != 0 || nil %>
            <dt class="accordion__title">Your Requests (<%= @borrows_pending.count %>)</dt>
            <dd class="accordion__content">
                <div class="tab--items">
                <% @borrows_pending.each do |item| %>
                    <div class="tab--item">
                    <%= link_to item_path(item) do %>
                        <div class="item--photo" style="background:url('<%= item.photo %>'); background-size: cover;">
                        </div>
                    <% end %>
                    <div class="bottom--section">
                        <div class="tab--name">
                            <h2><%= link_to "#{item.name}", item %></h2>
                        </div>
                        <div class="top--buttons">
                            <div class="edit">
                                <%= link_to(image_tag("icons/edit.png", :alt => "edit"), edit_item_path(item)) %>
                            </div>
                            <div class="calendar">
                                <%= link_to(image_tag("icons/calendar.png", :alt => "calendar"), item) %>
                            </div>
                        </div>
                    </div>
                    <div class="item--bottom">
                        <div class="price">$<%= '%.0f' % item.price %></div>
                        <div class="trash"><%= link_to(image_tag("icons/trash.png", :alt => "trash"), item_path(item), method: :delete, data: { confirm: 'Are you sure you want to delete this?' }) %></div>
                        </div>
                    </div>
                <% end %>
                <% if @borrows_pending.count == @borrows_pending.count % 3 + 1 || 2 %>
                    <div class="tab--item">
                    </div>
                <% end %>
                </div>
                
            </dd>
            <% end %>
            <% if @items_pending.count != 0 || nil %>
            <dt class="accordion__title">Their Requests (<%= @items_pending.count %>)</dt>
            <dd class="accordion__content">
                <div class="tab--items">
                <% @items_pending.each do |item| %>
                    <div class="tab--item">
                    <%= link_to item_path(item) do %>
                        <div class="item--photo" style="background:url('<%= item.photo %>'); background-size: cover;">
                        </div>
                    <% end %>
                    <div class="bottom--section">
                        <div class="tab--name">
                            <h2><%= link_to "#{item.name}", item %></h2>
                        </div>
                        <div class="top--buttons">
                            <div class="edit">
                                <%= link_to(image_tag("icons/edit.png", :alt => "edit"), edit_item_path(item)) %>
                            </div>
                            <div class="calendar">
                                <%= link_to(image_tag("icons/calendar.png", :alt => "calendar"), item) %>
                            </div>
                        </div>
                    </div>
                    <div class="item--bottom">
                        <div class="price">$<%= '%.0f' % item.price %></div>
                        <div class="trash"><%= link_to(image_tag("icons/approve.png", :alt => "approve"), "/loans/#{item.loans.last.id}/approve", data: { confirm: 'Are you sure you want to approve this loan?' }) %></div>
                        </div>
                    </div>
                <% end %>
                <% if @items_pending.count == @items_pending.count % 3 + 1 || 2 %>
                    <div class="tab--item">
                    </div>
                <% end %>
                </div>
                
            </dd>
            <% end %>
            <% if @in_their_house.count != 0 || nil %>
            <dt class="accordion__title">Loans (<%= @in_their_house.count %>)</dt>
            <dd class="accordion__content">
                <div class="tab--items">
                <% @in_their_house.each do |loan| %>
                    <div class="tab--item">
                    <%= link_to item_path(loan.item) do %>
                        <div class="item--photo" style="background:url('<%= loan.item.photo %>'); background-size: cover;">
                        </div>
                    <% end %>
                    <div class="bottom--section">
                        <div class="tab--name">
                            <h2><%= link_to "#{loan.item.name}", loan.item %></h2>
                        </div>
                        <div class="top--buttons">
                            <div class="edit">
                                <%= link_to(image_tag("icons/edit.png", :alt => "edit"), edit_item_path(loan.item)) %>
                            </div>
                            <div class="calendar">
                                <%= link_to(image_tag("icons/calendar.png", :alt => "calendar"), loan.item) %>
                            </div>
                        </div>
                    </div>
                    <div class="item--bottom">
                        <div class="price">$<%= '%.0f' % loan.item.price %></div>
                        <div class="trash"><%= link_to(image_tag("icons/trash.png", :alt => "trash"), item_path(loan.item), method: :delete, data: { confirm: 'Are you sure you want to delete this?' }) %></div>
                        </div>
                    </div>
                <% end %>
                <% if @in_their_house.count == @in_their_house.count % 3 + 1 || 2 %>
                    <div class="tab--item">
                    </div>
                <% end %>
                </div>
                
            </dd>
            <% end %>
            <% if @in_my_house.count != 0 || nil %>
            <dt class="accordion__title">Borrows (<%= @in_my_house.count %>)</dt>
            <dd class="accordion__content">
                <div class="tab--items">
                <% @in_my_house.each do |loan| %>
                    <div class="tab--item">
                    <%= link_to item_path(loan.item) do %>
                        <div class="item--photo" style="background:url('<%= loan.item.photo %>'); background-size: cover;">
                        </div>
                    <% end %>
                    <div class="bottom--section">
                        <div class="tab--name">
                            <h2><%= link_to "#{loan.item.name}", loan.item %></h2>
                        </div>
                        <div class="top--buttons">
                            <div class="edit">
                                <%= link_to(image_tag("icons/edit.png", :alt => "edit"), edit_item_path(loan.item)) %>
                            </div>
                            <div class="calendar">
                                <%= link_to(image_tag("icons/calendar.png", :alt => "calendar"), loan.item) %>
                            </div>
                        </div>
                    </div>
                    <div class="item--bottom">
                        <div class="price">$<%= '%.0f' % loan.item.price %></div>
                        <div class="trash"><%= link_to(image_tag("icons/trash.png", :alt => "trash"), item_path(loan.item), method: :delete, data: { confirm: 'Are you sure you want to delete this?' }) %></div>
                        </div>
                    </div>
                <% end %>
                <% if @in_my_house.count == @in_my_house.count % 3 + 1 || 2 %>
                    <div class="tab--item">
                    </div>
                <% end %>
                </div>
                
            </dd>
            <% end %>
            <% if @on_my_porch.count != 0 || nil %>
            <dt class="accordion__title">Inventory (<%= @on_my_porch.count %>)</dt>
            <dd class="accordion__content">
                <div class="tab--items">
                <% @on_my_porch.each do |item| %>
                    <div class="tab--item">
                    <%= link_to item_path(item) do %>
                        <div class="item--photo" style="background:url('<%= item.photo %>'); background-size: cover;">
                        </div>
                    <% end %>
                    <div class="bottom--section">
                        <div class="tab--name">
                            <h2><%= link_to "#{item.name}", item %></h2>
                        </div>
                        <div class="top--buttons">
                            <div class="edit">
                                <%= link_to(image_tag("icons/edit.png", :alt => "edit"), edit_item_path(item)) %>
                            </div>
                            <div class="calendar">
                                <%= link_to(image_tag("icons/calendar.png", :alt => "calendar"), item) %>
                            </div>
                        </div>
                    </div>
                    <div class="item--bottom">
                        <div class="price">$<%= '%.0f' % item.price %></div>
                        <div class="trash"><%= link_to(image_tag("icons/trash.png", :alt => "trash"), item_path(item), method: :delete, data: { confirm: 'Are you sure you want to delete this?' }) %></div>
                        </div>
                    </div>
                <% end %>
                <% if @on_my_porch.count == @on_my_porch.count % 3 + 1 || 2 %>
                    <div class="tab--item">
                    </div>
                <% end %>
                </div>
            </dd>
            <% end %>
            <dt class="add-item"><a href="items/new">Add An Item</a></dt>
        </dl>
    </section>
    <% if @community_items.count != nil || 0 %>
    <div class="nearby--listings">
        <div class="home--header">
          <div class="home--header--left">
              <div class="home--header--long">
              </div>
              <div class="home--header--short">
              </div>
          </div>
          <h2>NEARBY LISTINGS</h2>
          <div class="home--header--right">
              <div class="home--header--long">
              </div>
              <div class="home--header--short">
              </div>
          </div>
        </div>
        <div class="items">
        <% @community_items.each do |item| %>
              <div class="item">
                 <%= link_to item_path(item) do %>
                      <div class="item--photo" style="background:url('<%= item.photo %>'); background-size: cover;">
                      </div>
                 <% end %>

                  <div class="user--info index">
                      
                      <%= link_to item.user do %>
                          <div class="square">
                              <div class="pic" style="background: url(<%= item.user.photo.thumb %>); background-size: 100%; background-position: center center; background-repeat: no-repeat;">
                              </div>
                          </div>
                      <% end %>

                      <div class="username">
                          <%= link_to "#{item.user.first_name}", item.user %>
                      </div>
                  </div>

                  <div class="item--name">
                      <%= link_to "#{item.name}", item %>
                  </div>

                  <%= link_to item_path(item) do %>
                      <div class="price">
                          <%= "$#{'%.0f' % item.price}" %>
                          <%= image_tag("arrow.png", class: "arrow") %>
                      </div>
                  <% end %>
              </div>
          <% end %>
          <% if @community_items.count % 3 == 1 || @community_items.count == 2 || @community_items.count % 3 == 2 %>
            <div class="item">
            </div>
          <% end %>
          </div>
    </div>
    <% end %>
</section>

<script>
    if ($(window).width() > 768) {
        $('.accordion__content:not(:first)').hide();

        $('.accordion__title:first-child').addClass('active');
    } else {
        $('.accordion__content').hide();
    };

    $( ".accordion__content" ).wrapInner( "<div class='overflow-scrolling'></div>" );

    $('.accordion__title').on('click', function() {
        $('.accordion__content').hide();
        $(this).next().show().prev().addClass('active').siblings().removeClass('active');
    });
</script>