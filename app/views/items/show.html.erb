<div class="item--page--title">
  <%= @item.name %>
</div>

<div class="item--page--left--side">

  <div class="item--page--photo">
      <%= image_tag("#{@item.photo}", :alt => "#{@item.name}") %>
  </div>

  <div class="user--info item--page">
      <a href="<% @item.user %>">
      <div class="square">
          <div class="pic" style="background: url(<%= @item.user.photo %>); background-size: 100%">
          
          </div>
        </div>
      </a>

      <div class="username" id="username"><%= link_to "#{@item.user.username}", @item.user %></div>
      <div class="items--number">
        <% if @item.user.items.count == 1 %>
          1 ITEM
        <% else %>
          <%= @item.user.items.count %> ITEMS</div>
        <% end %>
  </div>

</div>

<div class="item--description">
    <%= @item.description %>
</div>

<div class="item--page--right--side">
  <div class="pinpoint--container">
      <div class="pinpoint">
        <%= image_tag("pinpoint.png") %>
      </div>
      <% a = Geokit::Geocoders::GoogleGeocoder.geocode "#{current_user.address} #{current_user.city} #{current_user.state} #{current_user.zip}" %>
      <% b = Geokit::Geocoders::GoogleGeocoder.geocode "#{@item.user.address} #{@item.user.city} #{@item.user.state} #{@item.user.zip}" %>
      <div class="distance--away">
        <%= a.distance_to(b).round(2) %> miles away
      </div>
  </div>
  <div class="loan--request item--page">
      <%= form_tag charges_path do %>
        <article>
          <label class="amount">
            <span>Borrow fee: <%= number_to_currency(@item.price) %></span>
          </label>
        </article>

        <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                data-description="<%= @item.name %> | Due in Two"
                data-amount="<%= (@item.price * 100).to_i %>"></script>
      <% end %>
      <%= form_for(@loan) do |f| %>
        <% if @loan.errors.any? %>
          <div id="error_explanation">
            <h2><%= pluralize(@loan.errors.count, "error") %> prohibited this loan from being saved:</h2>

            <ul>
            <% @loan.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
            </ul>
          </div>
        <% end %>

        <%= f.hidden_field :item_id, :value => @item.id %>
        <%= f.hidden_field :borrower_id, :value => current_user.id %>
        <%= f.hidden_field :loaner_id, :value => @item.user.id %>
        <div class="field">
          <%= f.label "BORROW ON" %><br>
          <%= f.datetime_select :reserved_start, :html => {:"data-provide" => 'datepicker'} %>
        </div>
        <div class="actions">
          <%= f.submit "Borrow This", :id => "borrow--this" %>
        </div>
      <% end %>
      
  </div>
</div>
